openapi: 3.0.1
info:
  title: AskYourCode
  description: Allows for searching, retrieving and summarizing documentation and program code for reasoning about a software project.
  version: 'v1'
servers:
  - url: https://plugin.askyourcode.ai
paths:
  /project:
    post:
      operationId: download
      summary: Downloads a project archive, extracts it, then indexes the documentation and code fragments into a database.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/downloadRequest'
      responses:
        "200":
          description: Archive downloaded, context indexing is in progress
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/downloadResponse'
  /project/{project_id}:
    delete:
      operationId: delete
      summary: Deletes a project from the database.
      parameters:
        - in: path
          name: project_id
          schema:
            type: string
          required: true
          description: Project ID
      responses:
        "200":
          description: OK
  /project/{project_id}/summarize:
    get:
      operationId: summarize
      summary: Summarizes the project, a subdirectory, a file or a code construct (function, class or method).
      parameters:
        - in: path
          name: project_id
          schema:
            type: string
          required: true
          description: Project ID
        - in: query
          name: path
          schema:
            type: string
          required: false
          description: File extension, filename or path of the documentation file to summarize.
          example: .md
        - in: query
          name: name
          schema:
            type: string
          required: false
          description: Fully qualified name or short name of the code construct to summarize.
          example: .md
      responses:
        "200":
          description: Summary
          content:
            text/plain:
              schema:
                type: string
  /project/{project_id}/search:
    get:
      operationId: search
      summary: Searches for documentation or code constructs (function, class or method).
      parameters:
        - in: path
          name: project_id
          schema:
            type: string
          required: true
          description: Project ID
        - in: query
          name: ext
          schema:
            type: string
          required: true
          description: File extension to narrow down the search to a specific document type.
          example: .py
        - in: query
          name: path
          schema:
            type: string
          required: false
          description: Patch of a project directory or file to narrow down the search.
        - in: query
          name: name
          schema:
            type: string
          required: false
          description: Fully qualified or simple name of the code construct to search for.
        - in: query
          name: text
          schema:
            type: string
          required: false
          description: Free text search on the file contents to further narrow down the results.
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/searchResponse'

components:
  schemas:
    downloadRequest:
      type: object
      required:
        - url
      properties:
        url:
          type: string
          description: URL of the ZIP archive to download directly without authentication.
          required: true
    downloadResponse:
      type: object
      required:
        - project_id
      properties:
        project_id:
          type: string
          description: Project ID (GUID)
          required: true
        progress:
          type: integer
          description: Percentage progress of content indexing. Missing if the indexing has completed. Text based search results may be incomplete until indexing finishes.
    summarizeResponse:
      type: object
      required:
        - summary
      properties:
        results:
          type: string
          description: Summary
          required: true
    searchResponse:
      type: object
      required:
        - path
        - lineno
        - text
      properties:
        path:
          type: string
          description: Relative file path (inside project).
        lineno:
          type: integer
          description: Line number to reconstruct the order of text fragments inside the same file.
        text:
          type: string
          description: Code or text fragment.
        name:
          type: string
          description: Name of the definition or declaration (program code only).
        progress:
          type: integer
          description: Percentage progress of content indexing. Missing if the indexing has completed. Signifies an incomplete search if present.
