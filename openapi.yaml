openapi: 3.0.1
info:
  title: AskYourCode
  description: A plugin that provides access to the source code and documentation of a software project provided by the user
  version: 'v1'
servers:
  - url: https://plugin.askyourcode.ai
paths:
  /project/{username}:
    post:
      operationId: downloadProject
      summary: Downloads the source code archive of the project, extracts the archive, splits the source code and documentation into fragments, stores the fragments into a vector database
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: Username of the logged in user. Use a `-` if not logged in
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/downloadProjectRequest'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/downloadProjectResponse'
  /project/{username}/{project_id}:
    delete:
      operationId: deleteProject
      summary: Deletes a project from the vector database
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: Username of the logged in user. Use a `-` if not logged in
        - in: path
          name: project_id
          schema:
            type: string
          required: true
          description: GUID of the project
      responses:
        "200":
          description: OK
  /project/{username}/{project_id}/search:
    get:
      operationId: search
      summary: Search for code or documentation fragments
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The name of the user.
        - in: path
          name: project_id
          schema:
            type: string
          required: true
          description: GUID of the project
        - in: query
          name: path
          schema:
            type: string
          required: false
          description: Glob pattern matching the path of the file inside the project (case-insensitive)
        - in: query
          name: name
          schema:
            type: string
          required: false
          description: Case sensitive match on class or function names, exact match as the tail of fully qualified names
        - in: query
          name: text
          schema:
            type: string
          required: false
          description: Text to search for cosine similarity in the vector database
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 10
            default: 1
          required: false
          description: Maximum number of results to return
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/searchResponse'

components:
  schemas:
    downloadProjectRequest:
      type: object
      required:
        - url
      properties:
        url:
          type: string
          description: The URL of the source code archive to download. Must point to a zip or tar.gz file which can be downloaded directly without authentication.
          required: true
    downloadProjectResponse:
      type: object
      required:
        - project_id
      properties:
        project_id:
          type: string
          description: GUID of the project
          required: true
        error:
          type: string
          description: Error message (missing if the request was successful)
          required: false
    searchResponse:
      type: object
      required:
        - results
      properties:
        results:
          type: array
          items:
            type: object
            required:
              - text
              - meta
            properties:
              text:
                type: string
                description: Text of the fragment
              meta:
                type: string
                description: Additional information on the fragment, allows for building a good intuition on the structure of the code and the project in general
          description: Search results
          required: true
